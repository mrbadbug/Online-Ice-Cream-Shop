<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Sweet Treats Ice Cream Shop</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #fffaf2;
  color: #333;
  text-align: center;
  margin: 0;
  padding: 0;
}
header {
  background: linear-gradient(to right, #ff66b2, #ff99cc);
  color: white;
  padding: 30px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
}
h1 {
  font-size: 2.5em;
}
.flavors {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 20px;
  margin: 30px auto;
  max-width: 1200px;
}
.flavor-card {
  background: white;
  border-radius: 10px;
  box-shadow: 0 6px 10px rgba(0, 0, 0, 0.1);
  padding: 15px;
  width: 220px;
  transition: transform 0.3s ease;
}
.flavor-card:hover {
  transform: translateY(-8px);
}
.flavor-card img {
  width: 100%;
  border-radius: 10px;
}
.add-button {
  background-color: #ff66b2;
  color: white;
  border: none;
  padding: 10px;
  cursor: pointer;
  border-radius: 5px;
}
.add-button:hover {
  background-color: #ff99cc;
}
.checkout-table {
  margin: 40px auto;
  width: 90%;
  max-width: 700px;
  background: #fff;
  border-radius: 10px;
  padding: 20px;
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
}
.checkout-table table {
  width: 100%;
  border-collapse: collapse;
}
.checkout-table th,
.checkout-table td {
  padding: 10px;
  border-bottom: 1px solid #ff66b2;
  text-align: center;
}
.total-row {
  font-weight: bold;
  margin-top: 10px;
}

.social-buttons {
  display: flex;
  justify-content: center;
  gap: 15px;
  margin: 40px 0 20px;
}
.social-buttons img {
  width: 45px;
  height: 45px;
  border-radius: 50%;
  cursor: pointer;
  transition: transform 0.3s ease;
}
.social-buttons img:hover {
  transform: scale(1.1);
}
</style>
</head>
<body>

<header>
  <h1>Sweet Treats Ice Cream Shop</h1>
  <p>Indulge in our irresistible flavors!</p>
</header>

<div class="flavors">
  <div class="flavor-card">
    <img src="images/vanilla.jpg" alt="Vanilla Delight" />
    <h3>Vanilla Delight</h3>
    <p>$5</p>
    <input type="number" id="vanillaQty" min="1" value="1" />
    <button class="add-button" onclick="addToCart('Vanilla Delight', 5, 'vanillaQty')">Add to Cart</button>
  </div>

  <div class="flavor-card">
    <img src="images/chocolate.jpg" alt="Chocolate Dream" />
    <h3>Chocolate Dream</h3>
    <p>$6</p>
    <input type="number" id="chocoQty" min="1" value="1" />
    <button class="add-button" onclick="addToCart('Chocolate Dream', 6, 'chocoQty')">Add to Cart</button>
  </div>

  <div class="flavor-card">
    <img src="images/strawberry.jpg" alt="Strawberry Surprise" />
    <h3>Strawberry Surprise</h3>
    <p>$7</p>
    <input type="number" id="strawQty" min="1" value="1" />
    <button class="add-button" onclick="addToCart('Strawberry Surprise', 7, 'strawQty')">Add to Cart</button>
  </div>

  <div class="flavor-card">
    <img src="images/mint.jpg" alt="Minty Fresh" />
    <h3>Minty Fresh</h3>
    <p>$6</p>
    <input type="number" id="mintQty" min="1" value="1" />
    <button class="add-button" onclick="addToCart('Minty Fresh', 6, 'mintQty')">Add to Cart</button>
  </div>

  <div class="flavor-card">
    <img src="images/caramel.jpg" alt="Caramel Crunch" />
    <h3>Caramel Crunch</h3>
    <p>$8</p>
    <input type="number" id="caramelQty" min="1" value="1" />
    <button class="add-button" onclick="addToCart('Caramel Crunch', 8, 'caramelQty')">Add to Cart</button>
  </div>

  <div class="flavor-card">
    <img src="images/pistachio.jpg" alt="Pistachio Paradise" />
    <h3>Pistachio Paradise</h3>
    <p>$9</p>
    <input type="number" id="pistaQty" min="1" value="1" />
    <button class="add-button" onclick="addToCart('Pistachio Paradise', 9, 'pistaQty')">Add to Cart</button>
  </div>
</div>

<div class="checkout-table">
  <h2>Your Cart</h2>
  <table>
    <thead>
      <tr>
        <th>Item</th>
        <th>Qty</th>
        <th>Total</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody id="cartTable"></tbody>
  </table>
  <div class="total-row">Total: $<span id="totalPrice">0</span></div>
  <button class="add-button" onclick="checkout()">Proceed to Checkout</button>
</div>

<div class="social-buttons">
  <img src="images/facebook.jpg" alt="Facebook" onclick="window.open('https://www.facebook.com','_blank')" />
  <img src="images/google.jpg" alt="Google" onclick="window.open('https://www.google.com','_blank')" />
  <img src="images/instagram.jpg" alt="Instagram" onclick="window.open('https://www.instagram.com','_blank')" />
</div>

<script>
let cart = [];
let total = 0;
let currentOrderId = null;

function addToCart(name, price, qtyId) {
  const qty = parseInt(document.getElementById(qtyId).value);
  cart.push({ name, price, qty, status: 'Unpaid' });
  total += price * qty;
  updateCart();
}

function updateCart() {
  const cartTable = document.getElementById('cartTable');
  cartTable.innerHTML = '';
  cart.forEach((item) => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${item.name}</td>
      <td>${item.qty}</td>
      <td>$${item.price * item.qty}</td>
      <td>${item.status}</td>
    `;
    cartTable.appendChild(row);
  });
  document.getElementById('totalPrice').textContent = total;
}

function checkout() {
  if (cart.length === 0) return alert('Your cart is empty!');
  const order = {
    items: JSON.stringify(cart),
    total_quantity: cart.reduce((sum, i) => sum + i.qty, 0),
    total_price: total,
  };

  fetch('http://localhost:3000/api/orders', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(order),
  })
    .then((res) => res.json())
    .then((data) => {
      currentOrderId = data.orderId;
      window.location.href = `payment.html?orderId=${currentOrderId}&amount=${total}&phone=01703360465`;
    })
    .catch((err) => console.error(err));
}

window.onload = () => {
  fetch('http://localhost:3000/api/orders')
    .then((res) => res.json())
    .then((orders) => {
      const latest = orders[0];
      if (latest) {
        cart = JSON.parse(latest.items);
        total = latest.total_price;
        cart.forEach((item) => (item.status = latest.status));
        updateCart();
      }
    });
};
</script>

</body>
</html>

